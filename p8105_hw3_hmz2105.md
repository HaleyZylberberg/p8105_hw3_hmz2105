p8105_hw3_hmz2105
================
Haley Zylberberg

``` r
library (tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

## Problem 2

This problem uses data from the Behavioral Risk Factors Surveillance
System for Selected Metropolitan Area Risk Trends (SMART) for 2002-2010.

First we call in the dataset.

``` r
library (p8105.datasets)
brfss_smart2010 
```

    ## # A tibble: 134,203 × 23
    ##     Year Locationabbr Locationdesc     Class Topic Question Response Sample_Size
    ##    <int> <chr>        <chr>            <chr> <chr> <chr>    <chr>          <int>
    ##  1  2010 AL           AL - Jefferson … Heal… Over… How is … Excelle…          94
    ##  2  2010 AL           AL - Jefferson … Heal… Over… How is … Very go…         148
    ##  3  2010 AL           AL - Jefferson … Heal… Over… How is … Good             208
    ##  4  2010 AL           AL - Jefferson … Heal… Over… How is … Fair             107
    ##  5  2010 AL           AL - Jefferson … Heal… Over… How is … Poor              45
    ##  6  2010 AL           AL - Jefferson … Heal… Fair… Health … Good or…         450
    ##  7  2010 AL           AL - Jefferson … Heal… Fair… Health … Fair or…         152
    ##  8  2010 AL           AL - Jefferson … Heal… Heal… Do you … Yes              524
    ##  9  2010 AL           AL - Jefferson … Heal… Heal… Do you … No                77
    ## 10  2010 AL           AL - Jefferson … Heal… Unde… Adults … Yes              316
    ## # ℹ 134,193 more rows
    ## # ℹ 15 more variables: Data_value <dbl>, Confidence_limit_Low <dbl>,
    ## #   Confidence_limit_High <dbl>, Display_order <int>, Data_value_unit <chr>,
    ## #   Data_value_type <chr>, Data_Value_Footnote_Symbol <chr>,
    ## #   Data_Value_Footnote <chr>, DataSource <chr>, ClassId <chr>, TopicId <chr>,
    ## #   LocationID <chr>, QuestionID <chr>, RESPID <chr>, GeoLocation <chr>

The problem will focus on the response to the question, what is “your
general health,” which is referred to as overall health, and which has
responses ordered from fair to excellent. I will re-format the dataset
to use appropriate variable names, and limit it to the overall health
topic. Next I will organize the responses as a factor taking levels
ordered from “Poor” to “Excellent.”

``` r
brfss_smart2010_df =
janitor::clean_names(brfss_smart2010)|>
  filter(topic == "Overall Health") |>
  rename(overall_health = response,
         state = locationabbr,
        county =  locationdesc) |>
  mutate(overall_health = forcats::fct_relevel(overall_health, c("Poor", "Fair", "Good", "Very good", "Excellent"))) |>
  select(year, state, county, overall_health, sample_size, data_value, confidence_limit_low, confidence_limit_high)
```

Next we will answer which states were observed at 7 or more locations in
2002 and 2010.

These are the states with 7 or more observations in 2002:

``` r
brfss_smart2010_df |>
  filter(year == 2002) |>
  distinct(state, year, county) |>
  group_by(state, year) |> 
  summarize(locations = n()) |>
  filter(locations >= 7) |>
  knitr::kable()
```

    ## `summarise()` has grouped output by 'state'. You can override using the
    ## `.groups` argument.

| state | year | locations |
|:------|-----:|----------:|
| CT    | 2002 |         7 |
| FL    | 2002 |         7 |
| MA    | 2002 |         8 |
| NC    | 2002 |         7 |
| NJ    | 2002 |         8 |
| PA    | 2002 |        10 |

These are the states with 7 or more observations in 2010:

``` r
brfss_smart2010_df |>
  filter(year == 2010) |>
  distinct(state, year, county) |>
  group_by(state, year) |> 
  summarize(locations = n()) |>
  filter(locations >= 7) |>
  knitr::kable()
```

    ## `summarise()` has grouped output by 'state'. You can override using the
    ## `.groups` argument.

| state | year | locations |
|:------|-----:|----------:|
| CA    | 2010 |        12 |
| CO    | 2010 |         7 |
| FL    | 2010 |        41 |
| MA    | 2010 |         9 |
| MD    | 2010 |        12 |
| NC    | 2010 |        12 |
| NE    | 2010 |        10 |
| NJ    | 2010 |        19 |
| NY    | 2010 |         9 |
| OH    | 2010 |         8 |
| PA    | 2010 |         7 |
| SC    | 2010 |         7 |
| TX    | 2010 |        16 |
| WA    | 2010 |        10 |

\##Problem 3

This problem includes data from NHANES regarding participant demographic
information and accelerometer data.

Import demographic data. Skip first 4 rows as they are notes. Remove
participants younger than 21 and those with missing data. Recode sex as
1= male and 2= female and education as 1=less than high school, 2= high
school, 3=more than high school. Next convert education to a factor.

``` r
Demographic_df = 
  read_csv("data/nhanes_covar.csv", skip = 4) |> 
  janitor::clean_names()|>
  filter(age > 21) |>
  drop_na() |>
  mutate(
 sex = case_match(
    sex, 2~ 'female', 1 ~ 'male'),
 education = case_match(
   education, 1 ~ "less than high school", 2 ~ "high school", 3~ "more than high school")) |> mutate (education = as.factor(education))
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Next, import and tidy accelerometer data. As part of tidying will pivot
longer.

``` r
accel_df = 
  read_csv("data/nhanes_accel.csv")|> 
  janitor::clean_names() |>
   pivot_longer(
    min1:min1440,
    names_to = "minute",
    names_prefix = "min",
    values_to = "minute_value"
  ) |>
     mutate(minute = as.numeric(minute))
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Merge datasets.

``` r
MIMS_df = 
  inner_join(Demographic_df, accel_df, by="seqn")
```

Next determine the number of men and women in each education level.
Represent this data in both table and visual format.

``` r
MIMS_df |> 
  pivot_wider(
    names_from = minute,
    values_from = minute_value
  ) |>
  group_by(sex, education) |> 
  janitor::tabyl(sex, education) |> 
  knitr::kable(digits = 2)
```

| sex    | high school | less than high school | more than high school |
|:-------|------------:|----------------------:|----------------------:|
| female |          23 |                    28 |                    59 |
| male   |          34 |                    27 |                    54 |

``` r
MIMS_df |> 
  pivot_wider(
    names_from = minute,
    values_from = minute_value
  ) |>
ggplot(aes(x = education, fill = sex)) +
  geom_bar(position = "dodge") +
  labs(title = "Count of Men and Women by Education Level",
       x = "Education Level",
       y = "Count") +
  viridis::scale_fill_viridis(
    name = "Education", 
    discrete = TRUE) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```

![](p8105_hw3_hmz2105_files/figure-gfm/calculate%20number%20of%20men%20and%20women%20per%20education%20level-1.png)<!-- -->

Majority of men and women in this dataset have more than a high school
degree (n=59 for women and n=54 for men). More men had less than a high
school degree than women (34 vs 23).

Next aggregate accelerometer data for each participant and create a
variable called total_activity. Next creat a scatter plot of total
activity for each participant by age, and compare males to females and
also group by education.

``` r
MIMS_df |> 
  group_by(seqn) |>
 mutate(total_activity = sum(minute_value)) |>
    mutate(education = forcats::fct_relevel(education, c("less than high school", "high school", "more than high school"))) |> 
  ggplot(aes(x = age, y = total_activity, color = sex)) +
    geom_point() +
  geom_smooth() + 
    facet_grid(~education)
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_hmz2105_files/figure-gfm/aggregate%20accelerometer%20data%20for%20each%20participants%20and%20plot-1.png)<!-- -->

Next aggregate accelerometer data by minute to create a variable of mean
activity. Then create a scatter plot of mean activity per minute of the
day comparing males to females and geouped by education.

``` r
MIMS_df|>
  group_by(minute, sex, education) |>
  summarize(mean_activity = mean(minute_value, na.rm = TRUE)) |>
   mutate(education = forcats::fct_relevel(education, c("less than high school", "high school", "more than high school"))) |>
  ggplot(aes(x = minute, y = mean_activity, color = sex)) +
    geom_point() + geom_smooth() + 
    facet_grid(~education)
```

    ## `summarise()` has grouped output by 'minute', 'sex'. You can override using the
    ## `.groups` argument.
    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_hmz2105_files/figure-gfm/aggregate%20accelerometer%20data%20by%20minute-1.png)<!-- -->
