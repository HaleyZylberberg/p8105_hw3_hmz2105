---
title: "p8105_hw3_hmz2105"
author: Haley Zylberberg
output: github_document
---

```{r setup}
library (tidyverse)
```

## Problem 2

This problem uses data from the Behavioral Risk Factors Surveillance System for Selected Metropolitan Area Risk Trends (SMART) for 2002-2010. 

First we call in the dataset.

```{r call in data for problem 2}
library (p8105.datasets)
brfss_smart2010 
```

The problem will focus on the response to the question, what is "your general health," which is referred to as overall health, and which has responses ordered from fair to excellent. I will re-format the dataset to use appropriate variable names, and limit it to the overall health topic. Next I will organize the responses as a factor taking levels ordered from “Poor” to “Excellent.”

```{r create and filter brfss dataframe}
brfss_smart2010_df =
janitor::clean_names(brfss_smart2010)|>
  filter(topic == "Overall Health") |>
  rename(overall_health = response,
         state = locationabbr,
        county =  locationdesc) |>
  mutate(overall_health = forcats::fct_relevel(overall_health, c("Poor", "Fair", "Good", "Very good", "Excellent"))) |>
  select(year, state, county, overall_health, sample_size, data_value, confidence_limit_low, confidence_limit_high)
```

Next we will answer which states were observed at 7 or more locations in 2002 and 2010.

These are the states with 7 or more observations in 2002:

```{r states with over 7 locations in 2002}
brfss_smart2010_df |>
  filter(year == 2002) |>
  distinct(state, year, county) |>
  group_by(state, year) |> 
  summarize(locations = n()) |>
  filter(locations >= 7) |>
  knitr::kable()
```

These are the states with 7 or more observations in 2010:

```{r states with over 7 locations in 2010}
brfss_smart2010_df |>
  filter(year == 2010) |>
  distinct(state, year, county) |>
  group_by(state, year) |> 
  summarize(locations = n()) |>
  filter(locations >= 7) |>
  knitr::kable()
```



##Problem 3

This problem includes data from NHANES regarding participant demographic information and accelerometer data.

Import demographic data. Skip first 4 rows as they are notes. Remove participants younger than 21 and those with missing data. Recode sex as 1= male and 2= female and education as 1=less than high school, 2= high school, 3=more than high school. Next convert education to a factor.

```{r import and tidy demographic data}
Demographic_df = 
  read_csv("data/nhanes_covar.csv", skip = 4) |> 
  janitor::clean_names()|>
  filter(age > 21) |>
  drop_na() |>
  mutate(
 sex = case_match(
    sex, 2~ 'female', 1 ~ 'male'),
 education = case_match(
   education, 1 ~ "less than high school", 2 ~ "high school", 3~ "more than high school")) |> mutate (education = as.factor(education))
```

Next, import and tidy accelerometer data. As part of tidying will pivot longer.

```{r import and tidy accelerometer data}
accel_df = 
  read_csv("data/nhanes_accel.csv")|> 
  janitor::clean_names() |>
   pivot_longer(
    min1:min1440,
    names_to = "minute",
    names_prefix = "min",
    values_to = "minute_value"
  ) |>
     mutate(minute = as.numeric(minute))

```

Merge datasets.

```{r merge}
MIMS_df = 
  inner_join(Demographic_df, accel_df, by="seqn")
```

Next determine the number of men and women in each education level. Represent this data in both table and visual format.

```{r calculate number of men and women per education level }
MIMS_df |> 
  pivot_wider(
    names_from = minute,
    values_from = minute_value
  ) |>
  group_by(sex, education) |> 
  janitor::tabyl(sex, education) |> 
  knitr::kable(digits = 2)

MIMS_df |> 
  pivot_wider(
    names_from = minute,
    values_from = minute_value
  ) |>
ggplot(aes(x = education, fill = sex)) +
  geom_bar(position = "dodge") +
  labs(title = "Count of Men and Women by Education Level",
       x = "Education Level",
       y = "Count") +
  viridis::scale_fill_viridis(
    name = "Education", 
    discrete = TRUE) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```

Majority of men and women in this dataset have more than a high school degree (n=59 for women and n=54 for men). More men had less than a high school degree than women (34 vs 23).

Next aggregate accelerometer data for each participant and create a variable called total_activity. Next creat a scatter plot of total activity for each participant by age, and compare males to females and also group by education.

```{r aggregate accelerometer data for each participants and plot}
MIMS_df |> 
  group_by(seqn) |>
 mutate(total_activity = sum(minute_value)) |>
    mutate(education = forcats::fct_relevel(education, c("less than high school", "high school", "more than high school"))) |> 
  ggplot(aes(x = age, y = total_activity, color = sex)) +
    geom_point() +
  geom_smooth() + 
    facet_grid(~education)
```

Next aggregate accelerometer data by minute to create a variable of mean activity. Then create a scatter plot of mean activity per minute of the day comparing males to females and geouped by education.

```{r aggregate accelerometer data by minute}
MIMS_df|>
  group_by(minute, sex, education) |>
  summarize(mean_activity = mean(minute_value, na.rm = TRUE)) |>
   mutate(education = forcats::fct_relevel(education, c("less than high school", "high school", "more than high school"))) |>
  ggplot(aes(x = minute, y = mean_activity, color = sex)) +
    geom_point() + geom_smooth() + 
    facet_grid(~education)

```
